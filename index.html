<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>لوحة تحكم البوت</title>
  <style>
    body {
      background-color: #000;
      color: #fff;
      font-family: sans-serif;
      text-align: center;
      padding: 30px;
    }

    button, select {
      padding: 12px 20px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      margin: 10px;
    }

    .green {
      background-color: #2ecc71;
      color: white;
    }

    .white {
      background-color: white;
      color: black;
    }

    img {
      border-radius: 50%;
      width: 80px;
      height: 80px;
      margin: 10px;
    }

    .guild {
      background-color: #111;
      padding: 15px;
      margin: 10px;
      border-radius: 10px;
    }
  </style>
</head>
<body>

  <h1>لوحة تحكم البوت</h1>

  <div id="login-section">
    <a href="https://discord.com/oauth2/authorize?client_id=1360270113001177118&redirect_uri=https%3A%2F%2Ftubular-parfait-58a9e4.netlify.app%2F&response_type=token&scope=identify%20guilds">
      <button class="green">تسجيل الدخول عبر ديسكورد</button>
    </a>
  </div>

  <div id="user-section" style="display: none;">
    <img id="user-avatar" src="" alt="User">
    <h2 id="user-name"></h2>

    <div id="guilds-list"></div>
  </div>

  <script>
    async function fetchData(token) {
      const userRes = await fetch("https://discord.com/api/users/@me", {
        headers: { Authorization: `Bearer ${token}` }
      });
      const guildsRes = await fetch("https://discord.com/api/users/@me/guilds", {
        headers: { Authorization: `Bearer ${token}` }
      });

      const user = await userRes.json();
      const guilds = await guildsRes.json();

      document.getElementById("login-section").style.display = "none";
      document.getElementById("user-section").style.display = "block";

      document.getElementById("user-avatar").src = `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png`;
      document.getElementById("user-name").textContent = `${user.username}#${user.discriminator}`;

      const guildsList = document.getElementById("guilds-list");
      guilds.forEach(guild => {
        if ((guild.permissions & 0x8) === 0x8) {
          const div = document.createElement("div");
          div.className = "guild";
          div.innerHTML = `
            <h3>${guild.name}</h3>
            <a href="https://discord.com/oauth2/authorize?client_id=1360270113001177118&scope=bot&permissions=8&guild_id=${guild.id}&response_type=code&redirect_uri=https%3A%2F%2Ftubular-parfait-58a9e4.netlify.app%2F">
              <button class="white">إدخال البوت</button>
            </a>
          `;
          guildsList.appendChild(div);
        }
      });
    }

    const hash = window.location.hash;
    if (hash.includes("access_token")) {
      const token = new URLSearchParams(hash.substring(1)).get("access_token");
      fetchData(token);
    }
  </script>

</body>
</html>
